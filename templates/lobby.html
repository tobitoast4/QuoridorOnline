{% extends "layout.html" %}
{% block body %}

<link rel="stylesheet" href="{{ url_for('static', filename='styles/lobby.css' )}}">
<div>
    <h1 class="font-effect-outline font-moul-white-big">QuoridorOnline</h1>
    <h2>LOBBY</h2>
    <br/>
    <br/>
    You
    <div class="element-box" style="display: flex">
        <input value="{{ user.name }}"
               id="input-players-name"
               type="text"
               style="width: 100%; border: none; font-size: 16px; font-weight: 600">
        <button style="display: inline-block;" id="button_update_player_name">
            <i class="fa fa-floppy-o" aria-hidden="true"></i>
        </button>
    </div>
    <br/>
    <br/>
    Share this link with your friends
    <div class="element-box" style="display: flex">
        <div id="link-to-lobby" style="width: 100%;"></div>
        <button onclick="copy_to_clipboard()" style="display: inline-block;">
            <i class="fa fa-files-o" aria-hidden="true"></i>
        </button>
    </div>
    <br/>
    <br/>
    List of players in lobby
    <div class="element-box">
        <div id="list_of_players">
            <!-- display loading until players are loaded-->
            <div style="margin: auto;" class="loader"></div>
        </div>
    </div>
    <br/>
    <div class="text-box">
        <a href="#" onclick="startGameAsync()" class="btn btn-white btn-animate">Start game</a>
    </div>
</div>

<!--this is the animated background-->
<div style="text-align: left; margin: 0; position: fixed; top: 0px; left: 0px; z-index: -1;">
    <canvas style=""></canvas>
    <script src="{{ url_for('static', filename='js/background_canvas.js' )}}"></script>
</div>

<script src="{{ url_for('static', filename='js/query_server.js' )}}"></script>

<script>
    server_url = "{{ server_url }}";
    current_lobby_id = "{{ lobby.lobby_id }}";
    this_player_id = "{{ user.id }}";
    this_player_name = "{{ user.name }}";

    let lobby_link = server_url + "lobby/" + current_lobby_id;
    console.log(lobby_link);
    $('#link-to-lobby').html("" + lobby_link);

    function copy_to_clipboard() {
        navigator.clipboard.writeText(lobby_link);
        showNotify("success", "", "Copied to clipboard", 2);
    }

    document.getElementById("button_update_player_name").onclick=async() => {
        await updatePlayerName();
    };

    getLobbyAsync();
    let intervalID = setInterval(() => { // see https://rapidapi.com/guides/api-requests-intervals
        getLobbyAsync();
    }, 500);
</script>
{% endblock %}